<p>正则过滤: <input id="filter" value="." /></p>
<p>
  <!-- 文本输入域 -->
  <textarea id="text" placeholder="文本内容..." cols="35"></textarea>
</p>
<button id="extractText">提取文本</button>
<button id="cancel">关闭</button>
<script>
  document.getElementById("extractText").onclick = () => {
    parent.postMessage({ pluginMessage: { type: "extract-text" } }, "*");
  };

  document.getElementById("cancel").onclick = () => {
    parent.postMessage({ pluginMessage: { type: "cancel" } }, "*");
  };
  // 接收来自插件的消息
  window.onmessage = (event) => {
    const { type, texts } = event.data.pluginMessage;
    if (type === "selected-text") {
      //使用正则过滤texts中的数据
      var filter = document.getElementById("filter").value;
      var reg = new RegExp(filter, "g");
      const newTexts = [];
      texts.forEach((text, index) => {
        //文本是否包含过滤内容
        if (text && text.match(reg)) {
          //包含过滤内容，将过滤内容替换为空
          newTexts.push(text);
        }
      });

      document.getElementById("text").innerHTML = newTexts.join("\n\n");
      //选中所有文本
      //document.getElementById("text").select();
      //设置按钮文本
      document.getElementById("extractText").innerText = `${newTexts.length}`;
    }
  };
</script>
<!-- 样式 -->
<style>
  body {
    font-family: sans-serif;
  }
  input {
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 4px 4px;
    box-sizing: border-box;
  }
  textarea {
    width: 100%;
    height: 50%;
    padding: 4px 4px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
  }
  button {
    margin-top: 2px;
    padding: 4px 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    background: #fff;
    cursor: pointer;
  }
</style>
