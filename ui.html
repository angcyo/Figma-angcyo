<p><span>文本正则过滤: </span><input id="filter" value="." /></p>
<p>
  <!-- 文本输入域 -->
  <textarea id="text" placeholder="文本内容..." cols="35"></textarea>
</p>
<button id="extractText">提取文本</button>
<button id="cancel">关闭</button>

<script>
  document.getElementById("extractText").onclick = () => {
    parent.postMessage({ pluginMessage: { type: "extract-text" } }, "*");
  };

  document.getElementById("cancel").onclick = () => {
    parent.postMessage({ pluginMessage: { type: "cancel" } }, "*");
  };
  // 接收来自插件的消息
  window.onmessage = (event) => {
    const { type, texts, data } = event.data.pluginMessage;
    if (type === "selected-text") {
      //使用正则过滤texts中的数据
      var filter = document.getElementById("filter").value;
      parent.postMessage(
        { pluginMessage: { type: "putItem", data: filter } },
        "*"
      );

      var reg = new RegExp(filter, "g");
      const newTexts = [];
      texts.forEach((text, index) => {
        //文本是否包含过滤内容
        if (text && text.match(reg)) {
          //包含过滤内容，将过滤内容替换为空
          newTexts.push(`"${text}"`);
        }
      });

      document.getElementById("text").innerHTML = newTexts.join("\n");
      //选中所有文本
      //document.getElementById("text").select();
      //设置按钮文本
      document.getElementById("extractText").innerText = `${newTexts.length}`;
    } else if (type === "getItem") {
      //console.log("getItem↓");
      //console.log(data);
      if (data) {
        document.getElementById("filter").value = data;
      }
    }
  };
</script>
<!-- 样式 -->
<style>
  body {
    font-family: sans-serif;
    font-size: 12px;
    font-weight: 400;
    color: #333;
    margin: 12px 12px;
    outline: none;
  }
  *:focus {
    outline-color: #30afe6;
  }
  input {
    border: 1px solid #ccc;
    border-radius: 4px;
    padding: 4px 4px;
    box-sizing: border-box;
  }
  textarea {
    width: 100%;
    height: 80%;
    padding: 4px 4px;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
  }
  button {
    margin-top: 2px;
    padding: 4px 10px;
    border: 1px solid #ccc;
    border-radius: 4px;
    background: #fff;
    cursor: pointer;
  }
</style>
